/*!
 * pick.js v3.5.0-alpha,Â 2013/06/03
 * By Amsul, http://amsul.ca
 * Hosted on http://amsul.github.io/pick.js
 * Licensed under MIT
 */
(function(e,t,n){var o={};n(o,t,t(document)),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd?define(o):e.Pick=o})(this,jQuery,function(e,t,n){e.Compose=function(o,r,i){function a(){return e._.node("div",e._.node("div",e._.node("div",e._.node("div",e._.trigger(r.content,g),d.box),d.wrap),d.frame),d.holder)}function s(e){e.stopPropagation(),"focus"==e.type&&g.$root.addClass(d.focused),g.open(!0)}var c={id:Math.abs(~~(1e9*Math.random()))},u=t.extend(!0,{},r.defaults,i),d=e._.prefix(r.prefix,t.extend({},e._.klasses(),u.klass)),p="INPUT"==o.nodeName,l=t(o),f=function(){r.keys=r.keys||{},e._.trigger(r.init,g,[g])},g=f.prototype={constructor:f,$node:l,extension:r,settings:u,klass:d,start:function(){return c.start?g:(c.methods={},c.start=!0,c.open=!1,g.$root=t(e._.node("div",a(),d.picker)).on("click",function(e){e.stopPropagation()}).on("focusin",function(e){g.$root.removeClass(d.focused),e.stopPropagation()}).on("mousedown","[data-pick]",function(e){e.stopPropagation()}).on("click","[data-pick]",function(){g.set("select",t(this).data("pick")).close()}),g._hidden=u.formatSubmit?"<span>need to do this...</span>":void 0,p&&(o.autofocus=o==document.activeElement,c.type=o.type,o.type="text",o.readOnly=!0,l.on("focus.P"+c.id+" click.P"+c.id,s).on("keydown.P"+c.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(g.close(),!1):((32==t||n||!c.open&&r.keys[t])&&(e.preventDefault(),e.stopPropagation(),n?g.clear().close():g.open(!0)),void 0)})),l.on("change.P"+c.id,function(){g._hidden&&console.log("need to update the hidden value with formatting")}).addClass(d.input).data("pick."+r.name,g)[p?"after":"append"](g.$root,g._hidden),g.on({start:r.onStart,render:r.onRender,stop:r.onStop,open:r.onOpen,close:r.onClose,set:r.onSet}).on({start:u.onStart,render:u.onRender,stop:u.onStop,open:u.onOpen,close:u.onClose,set:u.onSet}),o.autofocus&&g.open(!0),g.trigger("start").trigger("render"))},stop:function(){return c.start?(g.close(),g._hidden&&g._hidden.parentNode.removeChild(g._hidden),g.$root.remove(),l.removeClass(d.input).off(".P"+c.id).removeData(r.name),p&&(o.type=c.type,o.readOnly=!1),c.start=!1,g.trigger("stop"),c.methods={},g):g},open:function(t){return c.open||(c.open=!0,g.$root.addClass(d.opened)),t!==!0||c.active||(c.active=!0,l.addClass(d.active),p&&l.focus(),g.$root.addClass(d.opened),n.on("click.P"+c.id+" focusin.P"+c.id,function(e){e.target!=o&&e.target!=document&&g.close()}).on("keydown.P"+c.id,function(t){var n=t.keyCode,o=r.keys[n],i=t.target;27==n?g.close(!0):c.active&&o?(t.preventDefault(),o&&e._.trigger(r.keys.go,g,[o])):g.$root.find(i).length&&13==n&&(t.preventDefault(),i.click())})),g.trigger("open")},close:function(e){return e===!0&&(l.off("focus.P"+c.id).focus(),setTimeout(function(){l.on("focus.P"+c.id,s)},0)),c.open&&(c.open=!1,g.$root.removeClass(d.opened)),c.active&&(c.active=!1,l.removeClass(d.active),g.$root.removeClass(d.focused),n.off(".P"+c.id)),g.trigger("close")},render:function(){return g.$root.html(a()),g.trigger("render")},on:function(t,n){var o,r,i=e._.isObject(t),a=i?t:{};if(t){i||(a[t]=n);for(o in a)r=a[o],c.methods[o]=c.methods[o]||[],c.methods[o].push(r)}return g},trigger:function(t,n){var o=c.methods[t];return o&&o.map(function(t){e._.trigger(t,g,[n])}),g},get:function(t,n){return t=t||"value","value"==t?p?o.value:l.attr("data-value"):null!=c[t]?c[t]:e._.trigger(r.dict.get,g,[t,n])},set:function(t,n,o){var i,a,s,c=e._.isObject(t),u=c?t:{};if(t){c||(u[t]=n);for(i in u)a=u[i],i in r.dict.values&&(s=e._.trigger(r.dict.set,g,[i,a,o]),("select"==i||"highlight"==i||"clear"==i)&&("highlight"!=i&&l.attr(p?"value":"data-value","clear"==i?"":s).trigger("change"),g.render()))}return g.trigger("set",u)}};return(new f).start()},e._={EXTENSIONS:{},klasses:function(){return{picker:"",opened:"--opened",focused:"--focused",input:"input",active:"input--active",holder:"holder",frame:"frame",wrap:"wrap",box:"box"}},prefix:function(e,t){e=e||"picker";for(var n in t)className=t[n],t[n]=className?e+(className.match(/^--/)?"":"__")+className:e;return t},node:function(e,t,n,o){return null==t?"":(t=Array.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",o=o?" "+o:"","<"+e+n+o+">"+t+"</"+e+">")},range:function(t){for(var n="",o=e._.trigger(t.min,t);e._.trigger(t.max,t,[o])>=o;o+=t.i||1)n+=e._.trigger(t.item,t,[o]);return n},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},lead:function(e){return(10>e?"0":"")+e},isObject:function(e){return{}.toString.call(e).indexOf("Object")>-1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&0===e%1}},e.extend=function(n){if(!n||!n.name)throw"ComponentError: To create a picker extension, the component needs a name.";if(e._.EXTENSIONS[n.name])throw"ComponentError: A picker extension by this name has already been defined.";if(!n.content)throw"ComponentError: The extension needs some content to insert.";e._.EXTENSIONS[n.name]=n,n.alias&&(t.fn[n.alias]=function(e,t){return this.pick(n.name,e,t)})},t.fn.pick=function(n,o,r){var i=e._.EXTENSIONS[n],a=this.data("pick."+n);return"picker"==o?a:a&&"string"==typeof o?(e._.trigger(a[o],a,[r]),this):this.each(function(){var r=t(this);r.data(n)||new e.Compose(this,i,o)})}});